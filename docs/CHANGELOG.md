# Changelog

- **Feb 6, 2026**: Initial architecture plan and market research created
- **Feb 11, 2026**: Three UI design concept mockups (Observatory, Morning Edition, Briefing Room)
- **Feb 13, 2026**: Vision refined to conversational Navigator + graph Visualization Platform. Both docs fully rewritten. Problem statement added to market research.
- **Feb 13, 2026**: Design concepts updated to split-pane layout matching new vision
- **Feb 15, 2026**: GraphRAG prototyping phase:
  - Created `feature/graphrag-backend-engine` branch
  - Built 3 Jupyter notebooks implementing full GraphRAG pipeline
  - Set up Python venv with Jupyter kernel (`dkia-graphrag`)
  - Validated: entity extraction, graph construction, community detection, embeddings, triple-factor retrieval
  - Documented development environment setup (Ollama config, dependencies, kernel registration)
- **Feb 15, 2026**: Multi-source pipeline + interactive visualization:
  - Expanded notebook 01 from 1 hardcoded doc to 7 sources (4 arXiv + 3 web) with offline fallbacks
  - Added cross-document entity merging and source provenance tracking
  - Added entity-to-chunk provenance map (`entity_chunk_map`) in extraction results
  - Added sources table to SQLite schema with source_refs on entities and source_ref on chunks
  - Implemented content-type-aware temporal decay in notebook 03 (news: 7d, papers: 30d, reference: 365d)
  - Added cross-domain test queries spanning AI, biology, climate, astrophysics, neuroscience, economics, space
  - Installed new dependencies: arxiv, trafilatura
- **Feb 15, 2026**: Standalone Cytoscape.js visualization (replaced ipycytoscape):
  - Replaced ipycytoscape Jupyter widget with standalone HTML using Cytoscape.js CDN (3.30.4)
  - Dark theme (#0a0a0f), amber accents, COSE force-directed layout, community color-coded nodes
  - Interactive chunk expansion: click entity -> see source text chunks as nodes with hover tooltips
  - Sidebar with node info panel, expandable chunk cards, community legend, graph controls
  - Opened via `webbrowser.open()` -- works regardless of JupyterLab widget compatibility
  - Removed ipycytoscape and ipywidgets dependencies
- **Feb 15, 2026**: Community summaries in visualization:
  - Moved visualization to end of notebook 02 (Step 7) so LLM community summaries are available
  - Pipeline order: Load -> Graph -> Metrics -> Communities -> Summaries -> SQLite -> Visualization
  - Legend shows community titles (from LLM summaries) instead of just IDs
  - Clicking entity shows its community summary (title, executive summary, key insights) in sidebar
  - Clicking community in legend shows full summary with member list
- **Feb 15, 2026**: GitHub Wiki created:
  - Phase 0: Research & Vision (4 pages)
  - Phase 1: GraphRAG Engine (6 pages)
  - Home page with phase tracker, navigation, and development dates
- **Feb 16, 2026**: Full PDF extraction and pipeline resilience:
  - Replaced arXiv abstract-only fetch with full PDF download + pymupdf text extraction (~90K chars per paper vs ~1.5K)
  - Added `ARXIV_LIMIT`/`WEB_LIMIT` source controls for single-source debugging
  - Added retry logic (2 attempts, 180s timeout) in `chat_ollama` for timeout/HTTP errors
  - Added skip-on-error resilience: failed chunks are skipped with diagnostics, pipeline continues
  - Benchmarked LLM extraction: ~17.8s/chunk avg, ~62 min per paper, ~6.5 hours for all 7 sources
  - Installed pymupdf dependency
  - Wiki: added knowledge graph screenshot to Knowledge-Graph-and-Communities page
  - Wiki: added LLM extraction performance benchmarks and improvement roadmap to Key-Learnings page
- **Feb 16, 2026**: Hybrid extraction mode with GLiNER:
  - Added configurable `EXTRACTION_MODE` flag: `"llm"`, `"nlp"`, `"hybrid"` (recommended default)
  - Integrated GLiNER (`urchade/gliner_small-v2.1`) for zero-shot NER entity extraction in nlp/hybrid modes
  - GLiNER is multilingual by default -- single model handles English, Spanish, and more
  - Hybrid mode: GLiNER entities (~300x faster than LLM) + LLM relationships + LLM claims
  - NLP mode: GLiNER entities + co-occurrence relationships, no claims
  - Added per-document language detection via langdetect
  - spaCy incompatible with Python 3.14 -- GLiNER chosen as superior alternative
  - Installed gliner, langdetect; uninstalled spaCy
- **Feb 16, 2026**: Semantic entity grouping (non-destructive overlay):
  - Added Step 7 to notebook 01: semantic grouping layer on top of exact-name dedup
  - Embeds all entities with nomic-embed-text, computes cosine similarity matrix via numpy
  - Union-Find groups transitively similar entities (A~B, B~C -> all in one group)
  - Configurable `SIMILARITY_THRESHOLD` (default 0.85)
  - Produces `semantic_entity_groups` list + `entity_to_semantic_group` lookup map
- **Feb 16, 2026**: Semantic entity group compound node visualization in notebook 02:
  - Semantic groups rendered as Cytoscape.js compound/parent nodes
  - MAX_COMPOUND_SIZE=15 filter excludes oversized groups
  - Click compound node: sidebar shows canonical name, member list, similarity scores
- **Feb 16, 2026**: Algorithm reference paper:
  - Created `docs/graphrag-algorithm-paper.md` (19 sections, LaTeX math, Mermaid diagrams, complexity analysis)
  - Published to GitHub Wiki as Algorithm Reference page under Phase 1
- **Feb 16, 2026**: Optimize CLAUDE.md structure:
  - Moved changelog to `docs/CHANGELOG.md`
  - Moved development environment setup to `docs/dev-setup.md`
  - Condensed CLAUDE.md from ~400 to ~200 lines
- **Feb 16, 2026**: Optimize notebook 02 graph visualization (930 KB -> ~235 KB target):
  - Filtered isolated nodes (degree=0) from visualization layer; ~317 isolates removed, kept in DB
  - Collapsed singleton community summaries into "Other" bucket (347 -> ~22-39 legend items)
  - Deduplicated chunk text storage: 613 chunk refs with 4.4x duplication reduced via text index
  - Switched from COSE to fCOSE layout (CDN): faster rendering, disconnected component tiling, compound node support
  - Legend "Other" click handler highlights all uncategorized nodes
  - Database unchanged: all 466 entities, 146 relationships, 347 summaries preserved
- **Feb 17, 2026**: Replaced Louvain with Leiden community detection:
  - Switched from python-louvain to leidenalg + igraph
  - Leiden guarantees well-connected communities (fixes Louvain's disconnected community flaw)
  - Aligns with GraphRAG paper (arxiv:2404.16130) which specifies Leiden
  - NetworkX -> igraph conversion via `ig.Graph.from_networkx()`
- **Feb 17, 2026**: Multi-level Cytoscape.js drill-down visualization:
  - Level 0: Community meta-nodes only (~20-40 nodes), sized by member count, inter-community edges
  - Level 1: Click community to expand -> entity children appear inside compound container
  - Level 2: Click entity -> chunk expansion (preserved from previous version)
  - Removed fCOSE CDN dependency -- built-in `cose` layout handles all levels
  - Level indicator in sidebar shows current navigation depth
  - Collapse All button returns to Level 0 overview
  - Inter-community edge hover shows cross-topic relationship details
  - Semantic groups appear as nested compound nodes inside expanded communities
- **Feb 17, 2026**: Extracted visualization into standalone scripts:
  - Created `scripts/generate_viz.py` -- Cytoscape.js multi-level drill-down from SQLite
  - Created `scripts/generate_viz_plotly.py` -- Plotly fallback (entity + community views)
  - Created `scripts/templates/knowledge_graph.html` -- Cytoscape.js template with placeholders
  - Added `semantic_groups` and `entity_chunk_map` tables to SQLite schema (notebook 02)
  - Removed visualization cells (34-35) from notebook 02, replaced with pointer to script
  - Visualization can now be regenerated in seconds without re-running the pipeline
  - Fixed Cytoscape.js rendering bugs:
    - `#cy` container: `position: absolute` instead of `flex: 1` (canvas sizing)
    - Entity ID sanitization: special chars (`.#[]():"',\`) break CSS selectors
    - Expand layout: `descendants()` + `grid` instead of `children()` + `cose` (compound node crash)
- **Feb 17, 2026**: Visualization polish -- circular symmetry and overlap-free expand:
  - All node shapes changed to `ellipse` (communities, semantic groups, entities) for consistent circular appearance
  - Level 0 initial layout: `concentric` with larger communities toward center (replaced `grid`)
  - Level 1 expand: children placed in a circle using manual trigonometric positioning
  - Expand relayout: expanded community moves to center, collapsed nodes form ring outside with gap
  - Collapse relayout: all nodes return to concentric arrangement by size
  - Manual `arrangeInCircle()` + `relayoutTopLevel()` replaces built-in layouts for top-level (built-in layouts don't account for compound node bounding box size)
  - Plotly fallback script added (`scripts/generate_viz_plotly.py`) with entity and community views
  - Visualization considered complete for prototyping phase
- **Feb 18, 2026**: Koine Design System integration and frontend scaffold:
  - Created `feature/design-system-integration` branch
  - Moved Koine Design System into project at `design-system/` (CSS tokens, SVG logos, favicons, Tailwind 4 preset)
  - Created `docs/design-system.md` -- integration guide documenting structure, usage, philosophy, and assets
  - Updated `CLAUDE.md` with design system references and project structure
  - Created FastAPI application (`src/main.py`) with static file mounts for app assets and design system
  - Created `src/web/templates/base.html` -- shell template with Koine favicons, theme-color meta, CSS import
  - Created `src/web/templates/navigator.html` -- Navigator (chat) + Visualization (graph) panes
    - Inline SVG logos: minimal dove (navbar), reduced dove + 7 flames (welcome hero), full logo with people and knowledge graph edges (visualization pane)
    - Koine CSS classes: `.koine-wordmark`, `.koine-overline`, `.koine-animate-*`, `.koine-stagger`
    - Welcome state with suggestion cards (Explore, Synthesize, Discover, Summarize)
  - Created `src/web/static/css/app.css` -- 270+ lines using native Koine CSS custom properties
    - Imports `global.css` (tokens, themes, reset, typography, animations)
    - Split-pane layout, navbar, chat area, input area, visualization empty state
  - Added `pyproject.toml` (FastAPI, Uvicorn, Jinja2) and `package.json` (tailwindcss, @tailwindcss/cli)
  - Added `tailwind.config.js` root config using design-system preset
  - Tailwind CSS v4 build working via `npx @tailwindcss/cli`
  - Running locally with `uvicorn --reload` (no Docker needed during active development)
- **Feb 18, 2026**: Knowledge graph integration into Koine frontend:
  - Extracted 6 data variables from prototype HTML into `src/web/static/data/graph_data.json` (207KB)
    - 42 meta-elements, 40 communities, 96 chunk texts, 158 entity refs, 40 community summaries, 18 semantic groups
  - Created `src/web/static/css/graph.css` -- sidebar, legend, node info, chunk panel, tooltip styles using Koine tokens
  - Created `src/web/static/js/graph.js` -- full Cytoscape.js interaction logic:
    - 15-color Koine warm palette replacing bright prototype colors (gold, amber, sage, plum, teal, mocha)
    - Entity shapes by type: diamond (PERSON), hexagon (EVENT), rounded-rect (ORGANIZATION), etc.
    - Community expand/collapse, entity detail panel, chunk expansion (Level 0/1/2)
    - Interactive legend with click-to-focus, sidebar toggle, Fit/Collapse All/Reset controls
  - Updated `base.html` with `{% block extra_css %}` for per-page stylesheets
  - Updated `navigator.html`: replaced empty state with Cytoscape canvas + floating glassmorphism sidebar
  - Updated `.gitignore` with negation `!src/web/static/data/` for graph data
  - DS consistency audit: app.css (103 token refs), graph.css (77 token refs), 0 hardcoded colors
  - Updated PR #3 description, wiki Phase 2 page (+100 lines), Home.md
